<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Hero Academia: Tu Historia en UA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            background-color: #1a1a2e;
            color: #e2e8f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            line-height: 1.6;
            background-image: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=1471&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .adventure-container {
            background-color: rgba(45, 49, 66, 0.9);
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
            padding: 2.5rem;
            max-width: 900px;
            width: 95%;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            border: 2px solid #f72585;
        }

        .adventure-title {
            font-size: 2.8rem;
            font-weight: bold;
            color: #f72585;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
            margin-bottom: 1.5rem;
            font-family: 'Arial Black', sans-serif;
        }

        #story-text {
            font-size: 1.25rem;
            margin-bottom: 2rem;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(26, 32, 44, 0.8);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
            text-align: left;
            border: 1px solid #4cc9f0;
            line-height: 1.8;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        #story-text.visible {
            opacity: 1;
            transform: translateY(0);
        }

        #choices-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .choice-button {
            background: linear-gradient(135deg, #f72585 0%, #7209b7 100%);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 4px 15px rgba(114, 9, 183, 0.4);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .choice-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(114, 9, 183, 0.6);
        }

        .choice-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(114, 9, 183, 0.4);
        }

        .choice-button::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
            transition: all 0.3s ease;
        }

        .choice-button:hover::after {
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
        }

        #restart-button {
            background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.4);
            margin-top: 2rem;
        }
        #restart-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.6);
        }

        #player-stats {
            background-color: rgba(43, 59, 74, 0.8);
            padding: 1rem;
            border-radius: 0.75rem;
            font-size: 0.9rem;
            color: #cbd5e0;
            margin-top: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            border: 1px solid #4cc9f0;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        #player-stats div {
            margin: 0 0.5rem;
        }
        #player-stats span {
            font-weight: bold;
            color: #4cc9f0;
        }
        #player-inventory {
            font-size: 0.9rem;
            color: #cbd5e0;
            margin-top: 1rem;
            text-align: center;
        }
        #player-inventory ul {
            list-style: none;
            padding: 0;
            display: inline-block;
            text-align: left;
        }
        #player-inventory li {
            margin-bottom: 0.3rem;
            color: #9ae6b4;
        }

        /* Estilos para la pantalla de inicio */
        #start-screen {
            background-color: rgba(45, 49, 66, 0.95);
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
            padding: 2.5rem;
            max-width: 600px;
            width: 95%;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            border: 2px solid #f72585;
            position: absolute;
            z-index: 100;
        }
        #start-screen h2 {
            font-size: 2rem;
            font-weight: bold;
            color: #4cc9f0;
            margin-bottom: 1rem;
        }
        #start-screen label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            color: #cbd5e0;
        }
        #start-screen select, #start-screen button {
            width: 100%;
            padding: 0.8rem;
            border-radius: 0.5rem;
            border: 1px solid #4a5568;
            background-color: rgba(26, 32, 44, 0.8);
            color: #e2e8f0;
            font-size: 1rem;
            cursor: pointer;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        #start-screen select:focus, #start-screen button:focus {
            outline: none;
            border-color: #4cc9f0;
            box-shadow: 0 0 0 2px rgba(76, 201, 240, 0.3);
        }
        #start-screen button {
            background: linear-gradient(135deg, #f72585 0%, #7209b7 100%);
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 4px 15px rgba(114, 9, 183, 0.4);
        }
        #start-screen button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(114, 9, 183, 0.6);
        }
        
        /* Estilos para el minijuego de combate */
        #battle-screen {
            display: none;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .battle-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .battle-character {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 45%;
        }
        
        .battle-character img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid #f72585;
            margin-bottom: 0.5rem;
        }
        
        .health-bar {
            width: 100%;
            height: 20px;
            background-color: #4a5568;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #f72585, #7209b7);
            width: 100%;
            transition: width 0.3s ease;
        }
        
        .battle-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }
        
        .battle-log {
            height: 100px;
            overflow-y: auto;
            background-color: rgba(26, 32, 44, 0.8);
            padding: 0.5rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            text-align: left;
            border: 1px solid #4cc9f0;
        }
        
        /* Estilos para la barra de progreso del don */
        .quirk-progress-container {
            width: 100%;
            background-color: #4a5568;
            border-radius: 10px;
            margin: 1rem 0;
            overflow: hidden;
        }
        
        .quirk-progress-bar {
            height: 20px;
            background: linear-gradient(90deg, #4cc9f0, #4361ee);
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        /* Estilos para la pantalla de entrenamiento */
        .training-minigame {
            display: none;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .training-progress {
            width: 100%;
            height: 30px;
            background-color: #4a5568;
            border-radius: 15px;
            margin-bottom: 1rem;
            overflow: hidden;
        }
        
        .training-fill {
            height: 100%;
            background: linear-gradient(90deg, #f72585, #7209b7);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .training-button {
            padding: 0.8rem;
            border-radius: 0.5rem;
            background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        
        .training-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.4);
        }
        
        .training-button:active {
            transform: translateY(0);
        }
        
        /* Estilos para el sistema de reputación con personajes */
        .character-rep {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .character-rep img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 0.5rem;
            border: 2px solid #4cc9f0;
        }
        
        .rep-level {
            font-size: 0.8rem;
            color: #a0aec0;
        }

        .hidden {
            display: none !important;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .adventure-title { font-size: 2rem; }
            #story-text { font-size: 1rem; min-height: 120px; }
            .choice-button { font-size: 1rem; padding: 0.8rem 1rem; }
            .adventure-container { padding: 1.5rem; gap: 1rem; }
            #start-screen h2 { font-size: 1.6rem; }
            #start-screen select, #start-screen button { padding: 0.7rem; font-size: 0.9rem; }
        }
        @media (max-width: 480px) {
            .adventure-title { font-size: 1.6rem; }
            #story-text { font-size: 0.9rem; min-height: 100px; }
            .choice-button { font-size: 0.9rem; padding: 0.7rem 0.8rem; }
            #player-stats { flex-direction: column; gap: 0.5rem; }
            .battle-actions { grid-template-columns: 1fr; }
            .battle-character { width: 100%; margin-bottom: 1rem; }
            .battle-info { flex-direction: column; }
        }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1 class="adventure-title">My Hero Academia: Tu Historia en UA</h1>
        <h2>¡Crea tu Héroe!</h2>
        
        <div class="mb-4">
            <label for="gender-select">Elige tu Género:</label>
            <select id="gender-select">
                <option value="neutral">Neutral</option>
                <option value="male">Masculino</option>
                <option value="female">Femenino</option>
            </select>
        </div>
        
        <div class="mb-4">
            <label for="name-input">Nombre de tu Héroe:</label>
            <input type="text" id="name-input" placeholder="Ej: Dynamight Jr." class="w-full p-2 rounded border border-gray-600 bg-gray-800 text-white">
        </div>
        
        <div class="mb-6">
            <label for="quirk-select">Elige tu Don (Quirk):</label>
            <select id="quirk-select">
                <option value="fire">Manipulación de Fuego 🔥</option>
                <option value="ice">Generación de Hielo ❄️</option>
                <option value="strength">Super Fuerza 💪</option>
                <option value="speed">Super Velocidad ⚡</option>
                <option value="shadow">Manipulación de Sombras 🌑</option>
                <option value="healing">Regeneración ✨</option>
                <option value="electricity">Manipulación Eléctrica ⚡</option>
                <option value="gravity">Control de Gravedad 🌌</option>
            </select>
        </div>
        
        <div class="mb-6">
            <label for="personality-select">Personalidad Principal:</label>
            <select id="personality-select">
                <option value="heroic">Heroica 🦸 (Valiente, justo)</option>
                <option value="strategic">Estratégica 🧠 (Inteligente, calculador)</option>
                <option value="rebel">Rebelde 😈 (Impulsivo, independiente)</option>
                <option value="friendly">Amistoso 😊 (Sociable, compasivo)</option>
            </select>
        </div>
        
        <button id="start-game-button">¡Ingresar a UA!</button>
    </div>

    <div class="adventure-container hidden" id="game-container">
        <h1 class="adventure-title">My Hero Academia: Tu Historia en UA</h1>

        <div id="story-text" class="visible"></div>

        <div id="choices-container"></div>
        
        <div id="battle-screen">
            <div class="battle-info">
                <div class="battle-character">
                    <img id="player-battle-img" src="https://via.placeholder.com/100" alt="Tu personaje">
                    <div id="player-battle-name">Tú</div>
                    <div class="health-bar">
                        <div id="player-health" class="health-fill" style="width: 100%">100%</div>
                    </div>
                </div>
                <div class="battle-character">
                    <img id="enemy-battle-img" src="https://via.placeholder.com/100" alt="Enemigo">
                    <div id="enemy-battle-name">Enemigo</div>
                    <div class="health-bar">
                        <div id="enemy-health" class="health-fill" style="width: 100%">100%</div>
                    </div>
                </div>
            </div>
            
            <div class="battle-actions">
                <button class="battle-action" data-action="attack">Atacar 👊</button>
                <button class="battle-action" data-action="quirk">Usar Don 💥</button>
                <button class="battle-action" data-action="defend">Defender 🛡️</button>
                <button class="battle-action" data-action="item">Usar Objeto 🎒</button>
            </div>
            
            <div class="battle-log" id="battle-log"></div>
        </div>
        
        <div class="training-minigame">
            <h3>Entrenamiento de Don</h3>
            <p id="training-instruction">Haz clic repetidamente para entrenar tu don y aumentar su nivel.</p>
            <div class="training-progress">
                <div id="training-progress" class="training-fill" style="width: 0%"></div>
            </div>
            <button id="training-button" class="training-button">Entrenar 💪</button>
            <button id="finish-training" class="training-button">Finalizar Entrenamiento</button>
        </div>

        <button id="restart-button" class="hidden" onclick="startGame()">Reiniciar Aventura</button>

        <div id="player-stats">
            <div>Nombre: <span id="stat-name"></span></div>
            <div>Don: <span id="stat-quirk"></span></div>
            <div>Nivel Don: <span id="stat-quirklevel">1</span></div>
            <div>Heroísmo: <span id="stat-heroism">50</span></div>
            <div>Fuerza: <span id="stat-strength">5</span></div>
            <div>Velocidad: <span id="stat-speed">5</span></div>
            <div>Inteligencia: <span id="stat-intelligence">5</span></div>
            <div>Popularidad: <span id="stat-popularity">5</span></div>
        </div>
        
        <div class="quirk-progress-container">
            <div id="quirk-progress" class="quirk-progress-bar">Progreso del Don: 0%</div>
        </div>
        
        <div id="character-reps">
            <h3>Relaciones:</h3>
            <div class="character-rep">
                <img src="https://i.imgur.com/J6y2g8W.png" alt="Midoriya">
                <span>Midoriya: </span>
                <span id="rep-midoriya">Neutral</span>
                <span class="rep-level">(0/100)</span>
            </div>
            <div class="character-rep">
                <img src="https://i.imgur.com/3QX5WQb.png" alt="Bakugo">
                <span>Bakugo: </span>
                <span id="rep-bakugo">Neutral</span>
                <span class="rep-level">(0/100)</span>
            </div>
            <div class="character-rep">
                <img src="https://i.imgur.com/5Z2WQ9X.png" alt="Todoroki">
                <span>Todoroki: </span>
                <span id="rep-todoroki">Neutral</span>
                <span class="rep-level">(0/100)</span>
            </div>
            <div class="character-rep">
                <img src="https://i.imgur.com/7Q2WQ9X.png" alt="Uraraka">
                <span>Uraraka: </span>
                <span id="rep-uraraka">Neutral</span>
                <span class="rep-level">(0/100)</span>
            </div>
        </div>

        <div id="player-inventory">
            <h3>Inventario:</h3>
            <ul id="inventory-list">
                <li>Uniforme de UA</li>
            </ul>
        </div>
    </div>

    <div id="endings-summary-container" class="adventure-container hidden">
        <h2 class="adventure-title">Tu Legado en UA</h2>
        <div id="main-ending-text" class="story-text"></div>
        <h3 class="text-xl font-bold text-gray-300 mt-6 mb-3">Logros y Relaciones:</h3>
        <ul id="secondary-endings-list" class="text-left mx-auto max-w-md">
        </ul>
        <button id="final-restart-button" class="restart-button mt-8" onclick="showStartScreen()">Volver al Inicio</button>
    </div>

    <script>
        // --- Variables del Juego ---
        let playerState = {
            name: "",
            gender: "neutral",
            quirk: "fire",
            quirkLevel: 1,
            quirkProgress: 0,
            heroism: 50,
            strength: 5,
            speed: 5,
            intelligence: 5,
            popularity: 5,
            inventory: ["Uniforme de UA"],
            relationships: {
                midoriya: 0,
                bakugo: 0,
                todoroki: 0,
                uraraka: 0,
                allmight: 0,
                aizawa: 0
            },
            storyFlags: [],
            trainingProgress: 0,
            battleStats: {
                health: 100,
                maxHealth: 100,
                attack: 10,
                defense: 5,
                quirkPower: 15
            },
            currentEnemy: null,
            currentScene: "start",
            completedStorylines: []
        };

        // --- Definición de la Historia ---
        const story = {
            "start": {
                "text": (player) => `¡Bienvenid${player.gender === 'female' ? 'a' : 'o'} a la Academia UA, ${player.name}! El primer día de clases está por comenzar. El salón 1-A está lleno de futuros héroes, incluyendo a conocidos como Midoriya, Bakugo y Todoroki. El profesor Aizawa entra con una expresión sombría. "Hoy tendrán una prueba de aptitud", dice. ¿Qué haces?`,
                "choices": [
                    { "text": "Acercarte a Midoriya para hacer equipo 🤝", "nextSceneId": "team_midoriya", "effects": { "midoriya": 10 } },
                    { "text": "Retar a Bakugo a una competencia 💥", "nextSceneId": "challenge_bakugo", "effects": { "bakugo": 5, "heroism": -5 } },
                    { "text": "Quedarte solo y concentrarte en la prueba 🧠", "nextSceneId": "solo_test", "effects": { "intelligence": 2 } }
                ]
            },
            "team_midoriya": {
                "text": "Midoriya parece sorprendido pero contento de que te acerques. \"¡Claro que podemos ser equipo!\" dice con entusiasmo. Juntos, se preparan para la prueba que consiste en una carrera de obstáculos combinada con combate simulado.",
                "choices": [
                    { "text": "Usar tu don para crear un ataque combinado con Midoriya 💥", "nextSceneId": "combo_attack", "effects": { "midoriya": 15, "quirkProgress": 10 }, "requires": { "quirkLevel": 2 } },
                    { "text": "Dejar que Midoriya lidere mientras tú apoyas 🛡️", "nextSceneId": "support_midoriya", "effects": { "midoriya": 10, "popularity": 5 } },
                    { "text": "Tomar la iniciativa y liderar el equipo 🦸", "nextSceneId": "lead_team", "effects": { "heroism": 10, "strength": 3 } }
                ]
            },
            "challenge_bakugo": {
                "text": "Bakugo se ríe con arrogancia. \"¡Ja! ¿Crees que puedes competir conmigo? ¡Te destruiré!\" La prueba se convierte en un duelo personal entre ustedes dos.",
                "choices": [
                    { "text": "Atacar con todo tu poder desde el inicio 💢", "nextSceneId": "full_power_bakugo", "battle": "bakugo", "effects": { "bakugo": -10, "heroism": -5 } },
                    { "text": "Analizar los movimientos de Bakugo y contraatacar 🧠", "nextSceneId": "analyze_bakugo", "effects": { "intelligence": 5, "bakugo": 5 } },
                    { "text": "Intentar razonar con él durante la pelea 🗣️", "nextSceneId": "reason_bakugo", "effects": { "bakugo": -20, "popularity": -5 } }
                ]
            },
            "solo_test": {
                "text": "Decides enfrentar la prueba solo. Los obstáculos son difíciles, pero tu determinación es fuerte. En el segmento de combate, te enfrentas a robots de entrenamiento.",
                "choices": [
                    { "text": "Usar tu don de manera ofensiva contra los robots 💥", "nextSceneId": "offensive_quirk", "effects": { "quirkProgress": 15, "strength": 3 } },
                    { "text": "Encontrar debilidades en los robots y explotarlas 🎯", "nextSceneId": "exploit_weakness", "effects": { "intelligence": 5, "quirkProgress": 5 } },
                    { "text": "Ayudar a otros estudiantes mientras avanzas 🤝", "nextSceneId": "help_others", "effects": { "heroism": 10, "popularity": 10 } }
                ]
            },
            "combo_attack": {
                "text": "Tú y Midoriya crean un ataque combinado impresionante. Tu don y su One For All se complementan perfectamente, destruyendo los obstáculos con facilidad. Aizawa asiente aprobadoramente.",
                "choices": [
                    { "text": "Seguir trabajando con Midoriya en el resto de la prueba 🤝", "nextSceneId": "continue_with_midoriya", "effects": { "midoriya": 20, "quirkProgress": 10 } },
                    { "text": "Separarse para cubrir más terreno 🏃", "nextSceneId": "split_up", "effects": { "speed": 5 } },
                    { "text": "Demostrar tu poder individual para impresionar a los profesores 💪", "nextSceneId": "show_off", "effects": { "heroism": 10, "popularity": 5, "midoriya": -5 } }
                ]
            },
            "support_midoriya": {
                "text": "Dejas que Midoriya lidere mientras tú cubres sus puntos débiles. Trabajan bien juntos, pero algunos profesores parecen esperar más iniciativa de tu parte.",
                "choices": [
                    { "text": "Cambiar de estrategia y tomar más iniciativa 🦸", "nextSceneId": "take_initiative", "effects": { "heroism": 10, "midoriya": 5 } },
                    { "text": "Continuar apoyando, perfeccionando tu rol 🛡️", "nextSceneId": "perfect_support", "effects": { "intelligence": 5, "midoriya": 10 } },
                    { "text": "Pedir consejo a Midoriya sobre cómo mejorar 🗣️", "nextSceneId": "ask_advice", "effects": { "midoriya": 15, "quirkProgress": 10 } }
                ]
            },
            "lead_team": {
                "text": "Tomas el liderazgo del equipo. Midoriya parece sorprendido pero sigue tus órdenes. Tu confianza inspira a otros estudiantes a unirse a tu grupo.",
                "choices": [
                    { "text": "Organizar un ataque coordinado con todo el equipo 🎯", "nextSceneId": "coordinated_attack", "effects": { "heroism": 15, "popularity": 10 } },
                    { "text": "Enfrentar el mayor desafío tú solo para proteger a los demás 🛡️", "nextSceneId": "protect_others", "effects": { "heroism": 20, "strength": 5 } },
                    { "text": "Dividir al equipo en grupos especializados 🧩", "nextSceneId": "specialize_groups", "effects": { "intelligence": 10, "popularity": 5 } }
                ]
            },
            // ... (continuar con todas las escenas)
            
            // Batalla con Bakugo
            "full_power_bakugo": {
                "text": "¡La batalla contra Bakugo comienza! Él no se contendrá, así que prepárate para una pelea intensa.",
                "battle": "bakugo",
                "onWin": {
                    "nextSceneId": "win_against_bakugo",
                    "effects": { "bakugo": -20, "heroism": 15, "strength": 5 }
                },
                "onLose": {
                    "nextSceneId": "lose_against_bakugo",
                    "effects": { "bakugo": 20, "heroism": -10 }
                }
            },
            
            "win_against_bakugo": {
                "text": "¡Increíble! Has derrotado a Bakugo, quien parece genuinamente sorprendido. \"No está mal... para un novato\", gruñe, pero puedes ver un destello de respeto en sus ojos.",
                "choices": [
                    { "text": "Ayudar a Bakugo a levantarse 🤝", "nextSceneId": "help_bakugo_up", "effects": { "bakugo": 10, "heroism": 10 } },
                    { "text": "Dejarlo ahí y continuar con la prueba 🏃", "nextSceneId": "continue_after_bakugo", "effects": { "speed": 5 } },
                    { "text": "Frotarle la victoria en la cara 😈", "nextSceneId": "taunt_bakugo", "effects": { "bakugo": -30, "heroism": -15 } }
                ]
            },
            
            // Escenas de entrenamiento
            "quirk_training": {
                "text": "Has decidido entrenar tu don. El gimnasio de UA está equipado con todo lo necesario para desarrollar tus habilidades. ¿Cómo quieres entrenar?",
                "choices": [
                    { "text": "Entrenamiento de potencia 💥", "nextSceneId": "power_training", "minigame": "training", "effects": { "strength": 2 } },
                    { "text": "Entrenamiento de control 🎯", "nextSceneId": "control_training", "minigame": "training", "effects": { "intelligence": 2 } },
                    { "text": "Entrenamiento de resistencia 🏋️", "nextSceneId": "endurance_training", "minigame": "training", "effects": { "speed": 2 } }
                ]
            },
            
            // Finales principales
            "hero_exam": {
                "text": "¡El día del examen de héroe ha llegado! Después de todo tu entrenamiento, es hora de demostrar de qué estás hecho. El examen consiste en rescatar civiles en una ciudad simulada bajo ataque.",
                "choices": [
                    { "text": "Enfocarte en salvar a tantos civiles como puedas 🦸", "nextSceneId": "save_civilians", "effects": { "heroism": 20 } },
                    { "text": "Confrontar directamente a los villanos principales 💢", "nextSceneId": "fight_villains", "effects": { "strength": 10 } },
                    { "text": "Coordinar los esfuerzos de todos los estudiantes 🧠", "nextSceneId": "coordinate_rescue", "effects": { "intelligence": 15 } }
                ],
                "mainEndingPoint": true
            },
            
            "determine_ending": {
                "text": (player) => {
                    if (player.heroism >= 80) {
                        return story["ending_top_hero"].text;
                    } else if (player.heroism <= 20) {
                        return story["ending_villain"].text;
                    } else {
                        return story["ending_underground_hero"].text;
                    }
                },
                "choices": [],
                "ending": true
            },
            
            "ending_top_hero": {
                "text": "¡Felicidades! Te has graduado de UA como uno de los mejores héroes de tu generación. Tu valentía, compasión y habilidades te han ganado el respeto de todos, incluyendo a All Might. El futuro del heroísmo está en buenas             manos. ¡Plus Ultra!",
            "ending": true,
            "effects": { "popularity": 30 }
        },
        
        "ending_villain": {
            "text": "Tus acciones durante el examen revelan una oscura verdad: has estado usando métodos cuestionables. En lugar de un título de héroe, enfrentas consecuencias. Pero tal vez esto es lo que realmente querías...",
            "ending": true,
            "effects": { "heroism": -50 }
        },
        
        "ending_underground_hero": {
            "text": "Te gradúas de UA, pero no como un héroe de alto perfil. Prefieres trabajar entre bastidores, haciendo el trabajo importante que pocos ven. Aizawa te respeta por ello, y encuentras satisfacción en tu propio camino.",
            "ending": true,
            "effects": { "intelligence": 20 }
        }
    };

    // --- Funciones del Juego ---
    function startGame() {
        // Obtener valores del formulario de inicio
        playerState.name = document.getElementById('name-input').value || "Héroe sin Nombre";
        playerState.gender = document.getElementById('gender-select').value;
        playerState.quirk = document.getElementById('quirk-select').value.split(' ')[0];
        
        // Actualizar estadísticas mostradas
        updateStatsDisplay();
        
        // Ocultar pantalla de inicio y mostrar juego
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('game-container').classList.remove('hidden');
        
        // Comenzar la historia
        showScene("start");
    }
    
    function showScene(sceneId) {
        playerState.currentScene = sceneId;
        const scene = story[sceneId];
        
        // Mostrar texto de la escena
        const storyTextElement = document.getElementById('story-text');
        storyTextElement.classList.remove('visible');
        
        setTimeout(() => {
            storyTextElement.innerHTML = typeof scene.text === 'function' ? scene.text(playerState) : scene.text;
            storyTextElement.classList.add('visible');
        }, 300);
        
        // Limpiar opciones anteriores
        const choicesContainer = document.getElementById('choices-container');
        choicesContainer.innerHTML = '';
        
        // Ocultar elementos de batalla o entrenamiento si no son necesarios
        document.getElementById('battle-screen').style.display = 'none';
        document.querySelector('.training-minigame').style.display = 'none';
        
        // Mostrar minijuego si la escena lo requiere
        if (scene.minigame === 'training') {
            startTrainingMinigame(sceneId);
            return;
        }
        
        // Mostrar opciones de la escena
        if (scene.choices && scene.choices.length > 0) {
            scene.choices.forEach(choice => {
                // Verificar si el jugador cumple con los requisitos para esta opción
                let meetsRequirements = true;
                if (choice.requires) {
                    for (const [key, value] of Object.entries(choice.requires)) {
                        if (playerState[key] < value) {
                            meetsRequirements = false;
                            break;
                        }
                    }
                }
                
                if (meetsRequirements) {
                    const button = document.createElement('button');
                    button.className = 'choice-button';
                    button.textContent = choice.text;
                    button.onclick = () => selectChoice(choice);
                    choicesContainer.appendChild(button);
                }
            });
        } else if (scene.ending) {
            // Mostrar pantalla de finalización
            showEnding(sceneId);
        }
    }
    
    function selectChoice(choice) {
        // Aplicar efectos de la elección
        if (choice.effects) {
            for (const [key, value] of Object.entries(choice.effects)) {
                if (key in playerState) {
                    playerState[key] += value;
                } else if (key in playerState.relationships) {
                    playerState.relationships[key] += value;
                }
                
                // Asegurar que los valores no sean negativos (excepto relaciones)
                if (key !== 'midoriya' && key !== 'bakugo' && key !== 'todoroki' && key !== 'uraraka' && 
                    key in playerState && playerState[key] < 0) {
                    playerState[key] = 0;
                }
            }
        }
        
        // Actualizar estadísticas mostradas
        updateStatsDisplay();
        
        // Manejar batallas si la elección lleva a una
        if (choice.battle) {
            startBattle(choice.battle, choice.nextSceneId);
            return;
        }
        
        // Continuar a la siguiente escena
        if (choice.nextSceneId) {
            showScene(choice.nextSceneId);
        }
    }
    
    function updateStatsDisplay() {
        document.getElementById('stat-name').textContent = playerState.name;
        document.getElementById('stat-quirk').textContent = getQuirkName(playerState.quirk);
        document.getElementById('stat-quirklevel').textContent = playerState.quirkLevel;
        document.getElementById('stat-heroism').textContent = playerState.heroism;
        document.getElementById('stat-strength').textContent = playerState.strength;
        document.getElementById('stat-speed').textContent = playerState.speed;
        document.getElementById('stat-intelligence').textContent = playerState.intelligence;
        document.getElementById('stat-popularity').textContent = playerState.popularity;
        
        // Actualizar barra de progreso del don
        const quirkProgress = document.getElementById('quirk-progress');
        const progressPercentage = Math.min(100, (playerState.quirkProgress / (playerState.quirkLevel * 100)) * 100);
        quirkProgress.style.width = `${progressPercentage}%`;
        quirkProgress.textContent = `Progreso del Don: ${Math.floor(progressPercentage)}%`;
        
        // Actualizar relaciones
        updateRelationshipDisplay('midoriya');
        updateRelationshipDisplay('bakugo');
        updateRelationshipDisplay('todoroki');
        updateRelationshipDisplay('uraraka');
        
        // Actualizar inventario
        const inventoryList = document.getElementById('inventory-list');
        inventoryList.innerHTML = '';
        playerState.inventory.forEach(item => {
            const li = document.createElement('li');
            li.textContent = item;
            inventoryList.appendChild(li);
        });
    }
    
    function updateRelationshipDisplay(character) {
        const rep = playerState.relationships[character];
        const repElement = document.getElementById(`rep-${character}`);
        
        if (rep >= 50) {
            repElement.textContent = "Amistoso";
            repElement.style.color = "#4ade80";
        } else if (rep >= 20) {
            repElement.textContent = "Positivo";
            repElement.style.color = "#a3e635";
        } else if (rep <= -20) {
            repElement.textContent = "Hostil";
            repElement.style.color = "#f87171";
        } else if (rep <= -50) {
            repElement.textContent = "Enemigo";
            repElement.style.color = "#ef4444";
        } else {
            repElement.textContent = "Neutral";
            repElement.style.color = "#cbd5e0";
        }
        
        // Actualizar contador numérico
        const repLevelElement = repElement.nextElementSibling;
        repLevelElement.textContent = `(${rep}/100)`;
    }
    
    function getQuirkName(quirkKey) {
        const quirkNames = {
            "fire": "Manipulación de Fuego",
            "ice": "Generación de Hielo",
            "strength": "Super Fuerza",
            "speed": "Super Velocidad",
            "shadow": "Manipulación de Sombras",
            "healing": "Regeneración",
            "electricity": "Manipulación Eléctrica",
            "gravity": "Control de Gravedad"
        };
        return quirkNames[quirkKey] || quirkKey;
    }
    
    // --- Sistema de Batalla ---
    function startBattle(enemyId, nextSceneId) {
        playerState.currentEnemy = enemyId;
        playerState.battleStats.health = playerState.battleStats.maxHealth;
        
        // Configurar enemigo
        const enemies = {
            "bakugo": {
                name: "Bakugo",
                img: "https://i.imgur.com/3QX5WQb.png",
                health: 80,
                maxHealth: 80,
                attack: 15,
                defense: 8,
                quirkPower: 20
            },
            "villain": {
                name: "Villano",
                img: "https://i.imgur.com/9Q2WQ9X.png",
                health: 60,
                maxHealth: 60,
                attack: 12,
                defense: 5,
                quirkPower: 15
            },
            "robot": {
                name: "Robot de Entrenamiento",
                img: "https://i.imgur.com/8Q2WQ9X.png",
                health: 40,
                maxHealth: 40,
                attack: 10,
                defense: 10,
                quirkPower: 0
            }
        };
        
        const enemy = enemies[enemyId];
        playerState.currentEnemyData = enemy;
        
        // Actualizar UI de batalla
        document.getElementById('enemy-battle-name').textContent = enemy.name;
        document.getElementById('enemy-battle-img').src = enemy.img;
        document.getElementById('enemy-health').style.width = '100%';
        document.getElementById('enemy-health').textContent = '100%';
        
        document.getElementById('player-battle-name').textContent = playerState.name;
        document.getElementById('player-health').style.width = '100%';
        document.getElementById('player-health').textContent = '100%';
        
        // Limpiar registro de batalla
        document.getElementById('battle-log').innerHTML = '';
        
        // Mostrar pantalla de batalla
        document.getElementById('battle-screen').style.display = 'flex';
        document.getElementById('choices-container').innerHTML = '';
        
        // Configurar botones de batalla
        document.querySelectorAll('.battle-action').forEach(button => {
            button.onclick = () => handleBattleAction(button.dataset.action, nextSceneId);
        });
    }
    
    function handleBattleAction(action, nextSceneId) {
        const player = playerState.battleStats;
        const enemy = playerState.currentEnemyData;
        
        // Acción del jugador
        let playerDamage = 0;
        let enemyDamage = 0;
        let battleLog = document.getElementById('battle-log');
        
        switch(action) {
            case 'attack':
                playerDamage = Math.max(1, player.attack - Math.floor(enemy.defense / 2));
                addBattleLog(`${playerState.name} ataca a ${enemy.name} por ${playerDamage} de daño!`);
                break;
            case 'quirk':
                if (playerState.quirkLevel >= 2) {
                    playerDamage = Math.max(3, player.quirkPower - Math.floor(enemy.defense / 3));
                    addBattleLog(`${playerState.name} usa ${getQuirkName(playerState.quirk)} contra ${enemy.name} por ${playerDamage} de daño!`);
                    playerState.quirkProgress += 5;
                } else {
                    addBattleLog("¡Tu don no está lo suficientemente desarrollado para usarlo en batalla!");
                    return;
                }
                break;
            case 'defend':
                player.defense *= 1.5;
                addBattleLog(`${playerState.name} se defiende! La defensa aumenta temporalmente.`);
                break;
            case 'item':
                if (playerState.inventory.includes("Botiquín")) {
                    player.health = Math.min(player.maxHealth, player.health + 30);
                    playerState.inventory = playerState.inventory.filter(item => item !== "Botiquín");
                    addBattleLog(`${playerState.name} usa un Botiquín y recupera 30 de salud!`);
                } else {
                    addBattleLog("¡No tienes objetos para usar!");
                    return;
                }
                break;
        }
        
        // Aplicar daño al enemigo
        enemy.health -= playerDamage;
        if (enemy.health <= 0) {
            enemy.health = 0;
            endBattle(true, nextSceneId);
            return;
        }
        
        // Turno del enemigo (si no se defendió)
        if (action !== 'defend') {
            enemyDamage = Math.max(1, enemy.attack - Math.floor(player.defense / 2));
            player.health -= enemyDamage;
            addBattleLog(`${enemy.name} contraataca y causa ${enemyDamage} de daño!`);
            
            if (player.health <= 0) {
                player.health = 0;
                endBattle(false, nextSceneId);
                return;
            }
        } else {
            // Restablecer defensa después del turno
            player.defense = playerState.battleStats.defense;
        }
        
        // Actualizar barras de salud
        updateHealthBars();
    }
    
    function addBattleLog(message) {
        const log = document.getElementById('battle-log');
        const entry = document.createElement('div');
        entry.textContent = message;
        log.appendChild(entry);
        log.scrollTop = log.scrollHeight;
    }
    
    function updateHealthBars() {
        const player = playerState.battleStats;
        const enemy = playerState.currentEnemyData;
        
        const playerHealthPercent = (player.health / player.maxHealth) * 100;
        const enemyHealthPercent = (enemy.health / enemy.maxHealth) * 100;
        
        const playerHealthBar = document.getElementById('player-health');
        const enemyHealthBar = document.getElementById('enemy-health');
        
        playerHealthBar.style.width = `${playerHealthPercent}%`;
        playerHealthBar.textContent = `${Math.floor(playerHealthPercent)}%`;
        
        enemyHealthBar.style.width = `${enemyHealthPercent}%`;
        enemyHealthBar.textContent = `${Math.floor(enemyHealthPercent)}%`;
    }
    
    function endBattle(playerWon, nextSceneId) {
        const enemy = playerState.currentEnemyData;
        
        if (playerWon) {
            addBattleLog(`¡Has derrotado a ${enemy.name}!`);
            
            // Recompensas por ganar
            playerState.heroism += 10;
            playerState.strength += 2;
            playerState.quirkProgress += 15;
            
            // Verificar si el progreso del don aumenta el nivel
            checkQuirkLevelUp();
            
            // Actualizar estadísticas
            updateStatsDisplay();
            
            // Continuar a la siguiente escena después de un retraso
            setTimeout(() => {
                showScene(nextSceneId);
            }, 2000);
        } else {
            addBattleLog(`¡Has sido derrotado por ${enemy.name}!`);
            
            // Consecuencias por perder
            playerState.heroism -= 5;
            
            // Continuar a la siguiente escena después de un retraso
            setTimeout(() => {
                showScene(story[nextSceneId].onLose.nextSceneId);
            }, 2000);
        }
    }
    
    // --- Minijuego de Entrenamiento ---
    function startTrainingMinigame(sceneId) {
        playerState.trainingProgress = 0;
        document.getElementById('training-progress').style.width = '0%';
        
        // Configurar instrucciones basadas en el tipo de entrenamiento
        let instruction = "";
        switch(sceneId) {
            case "power_training":
                instruction = "Haz clic repetidamente para aumentar la potencia de tu don!";
                break;
            case "control_training":
                instruction = "Haz clic con precisión para mejorar el control de tu don!";
                break;
            case "endurance_training":
                instruction = "Mantén un ritmo constante para aumentar tu resistencia!";
                break;
        }
        
        document.getElementById('training-instruction').textContent = instruction;
        
        // Mostrar minijuego
        document.querySelector('.training-minigame').style.display = 'flex';
        document.getElementById('choices-container').innerHTML = '';
        
        // Configurar botón de entrenamiento
        document.getElementById('training-button').onclick = () => {
            // Aumentar progreso basado en el tipo de entrenamiento
            let increment = 0;
            switch(sceneId) {
                case "power_training":
                    increment = 5 + Math.floor(playerState.strength / 5);
                    break;
                case "control_training":
                    increment = 3 + Math.floor(playerState.intelligence / 3);
                    break;
                case "endurance_training":
                    increment = 4 + Math.floor(playerState.speed / 4);
                    break;
            }
            
            playerState.trainingProgress += increment;
            const progressPercent = Math.min(100, playerState.trainingProgress);
            
            document.getElementById('training-progress').style.width = `${progressPercent}%`;
            
            // Efectos visuales
            const button = document.getElementById('training-button');
            button.style.transform = 'scale(0.95)';
            setTimeout(() => {
                button.style.transform = '';
            }, 100);
            
            // Completado
            if (playerState.trainingProgress >= 100) {
                finishTraining(sceneId);
            }
        };
        
        // Configurar botón para terminar temprano
        document.getElementById('finish-training').onclick = () => {
            finishTraining(sceneId);
        };
    }
    
    function finishTraining(sceneId) {
        // Recompensas basadas en el progreso
        const progressPercent = Math.min(100, playerState.trainingProgress);
        
        // Recompensa base
        let reward = Math.floor(progressPercent / 10);
        
        // Aplicar recompensas específicas
        switch(sceneId) {
            case "power_training":
                playerState.strength += reward;
                playerState.quirkProgress += progressPercent * 0.8;
                break;
            case "control_training":
                playerState.intelligence += reward;
                playerState.quirkProgress += progressPercent * 0.6;
                break;
            case "endurance_training":
                playerState.speed += reward;
                playerState.quirkProgress += progressPercent * 0.5;
                break;
        }
        
        // Verificar si el progreso del don aumenta el nivel
        checkQuirkLevelUp();
        
        // Actualizar estadísticas
        updateStatsDisplay();
        
        // Ocultar minijuego
        document.querySelector('.training-minigame').style.display = 'none';
        
        // Continuar a la siguiente escena
        showScene(sceneId);
    }
    
    function checkQuirkLevelUp() {
        const requiredProgress = playerState.quirkLevel * 100;
        if (playerState.quirkProgress >= requiredProgress) {
            playerState.quirkLevel++;
            playerState.quirkProgress = 0;
            
            // Mostrar mensaje de nivel aumentado
            const storyTextElement = document.getElementById('story-text');
            storyTextElement.innerHTML = `¡Felicidades! Tu don ${getQuirkName(playerState.quirk)} ha alcanzado el nivel ${playerState.quirkLevel}!`;
            
            // Aumentar estadísticas relacionadas con el don
            playerState.battleStats.quirkPower += 5;
            
            // Pequeña pausa antes de continuar
            setTimeout(() => {
                showScene(playerState.currentScene);
            }, 1500);
        }
    }
    
    // --- Sistema de Finales ---
    function showEnding(sceneId) {
        const ending = story[sceneId];
        
        // Ocultar juego y mostrar pantalla de final
        document.getElementById('game-container').classList.add('hidden');
        document.getElementById('endings-summary-container').classList.remove('hidden');
        
        // Mostrar final principal
        document.getElementById('main-ending-text').innerHTML = ending.text;
        
        // Generar logros y relaciones
        const endingsList = document.getElementById('secondary-endings-list');
        endingsList.innerHTML = '';
        
        // Logros basados en estadísticas
        addEndingListItem(`Tu don ${getQuirkName(playerState.quirk)} alcanzó el nivel ${playerState.quirkLevel}!`);
        
        if (playerState.heroism >= 70) {
            addEndingListItem("Te convertiste en un héroe ejemplar, admirado por tu valentía y principios.");
        } else if (playerState.heroism <= 30) {
            addEndingListItem("Tu enfoque pragmático te ganó reputación como un héroe controvertido.");
        }
        
        if (playerState.strength >= 15) {
            addEndingListItem("Desarrollaste una fuerza física impresionante, rivalizando con los mejores héroes.");
        }
        
        if (playerState.intelligence >= 15) {
            addEndingListItem("Tu inteligencia y estrategia te distinguieron como un líder natural.");
        }
        
        // Relaciones importantes
        if (playerState.relationships.midoriya >= 50) {
            addEndingListItem("Formaste una fuerte amistad con Izuku Midoriya, convirtiéndote en uno de sus aliados más confiables.");
        } else if (playerState.relationships.midoriya <= -30) {
            addEndingListItem("Tu relación con Midoriya fue tensa, con frecuentes desacuerdos en tus métodos.");
        }
        
        if (playerState.relationships.bakugo >= 30) {
            addEndingListItem("A pesar de su personalidad, ganaste el respeto de Katsuki Bakugo, un logro raro.");
        } else if (playerState.relationships.bakugo <= -50) {
            addEndingListItem("Desarrollaste una intensa rivalidad con Bakugo, con enfrentamientos frecuentes.");
        }
        
        if (playerState.relationships.todoroki >= 40) {
            addEndingListItem("Shoto Todoroki te consideraba un amigo cercano y un compañero confiable.");
        }
        
        if (playerState.relationships.uraraka >= 60) {
            addEndingListItem("Ochaco Uraraka se convirtió en tu mejor amiga, apoyándote en cada paso.");
        }
    }
    
    function addEndingListItem(text) {
        const li = document.createElement('li');
        li.className = 'mb-2 text-gray-300';
        li.innerHTML = `✓ ${text}`;
        document.getElementById('secondary-endings-list').appendChild(li);
    }
    
    function showStartScreen() {
        // Reiniciar estado del juego
        playerState = {
            name: "",
            gender: "neutral",
            quirk: "fire",
            quirkLevel: 1,
            quirkProgress: 0,
            heroism: 50,
            strength: 5,
            speed: 5,
            intelligence: 5,
            popularity: 5,
            inventory: ["Uniforme de UA"],
            relationships: {
                midoriya: 0,
                bakugo: 0,
                todoroki: 0,
                uraraka: 0,
                allmight: 0,
                aizawa: 0
            },
            storyFlags: [],
            trainingProgress: 0,
            battleStats: {
                health: 100,
                maxHealth: 100,
                attack: 10,
                defense: 5,
                quirkPower: 15
            },
            currentEnemy: null,
            currentScene: "start",
            completedStorylines: []
        };
        
        // Mostrar pantalla de inicio
        document.getElementById('endings-summary-container').classList.add('hidden');
        document.getElementById('start-screen').classList.remove('hidden');
    }
    
    // --- Inicialización ---
    document.getElementById('start-game-button').addEventListener('click', startGame);
    document.getElementById('final-restart-button').addEventListener('click', showStartScreen);
    
    // Configurar botón de reinicio
    document.getElementById('restart-button').addEventListener('click', () => {
        if (confirm("¿Estás seguro de que quieres reiniciar la aventura? Perderás todo tu progreso.")) {
            showStartScreen();
        }
    });
</script>
</body>
</html>
